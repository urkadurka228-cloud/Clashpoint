<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–∫—Ä—ã—Ç–∏–µ –∏ –ê—Ç–∞–∫–∞ - –ú–æ–±–∏–ª—å–Ω–∞—è –ò–≥—Ä–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
            -webkit-user-select: none;
            user-select: none;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            padding: 10px;
        }
        
        .game-container {
            text-align: center;
            max-width: 100%;
        }
        
        h1 {
            color: #fff;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            font-size: 24px;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 10px 10px 0 0;
            font-size: 18px;
            margin-bottom: -2px;
        }
        
        canvas {
            display: block;
            background: #87CEEB;
            border: 3px solid #333;
            border-radius: 0 0 10px 10px;
            max-width: 100%;
            height: auto;
        }
        
        .controls-info {
            color: #fff;
            margin-top: 15px;
            font-size: 16px;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 10px;
        }
        
        .instructions {
            color: #ddd;
            margin-top: 10px;
            font-size: 14px;
            line-height: 1.4;
        }
        
        @media (max-height: 700px) {
            h1 { font-size: 20px; margin-bottom: 5px; }
            .game-info { font-size: 16px; padding: 8px 15px; }
            .controls-info { font-size: 14px; }
            .instructions { font-size: 12px; }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>üéØ –£–∫—Ä—ã—Ç–∏–µ –∏ –ê—Ç–∞–∫–∞ üéØ</h1>
        <div class="game-info">
            <div>‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ: <span id="health">100%</span></div>
            <div>‚≠ê –û—á–∫–∏: <span id="score">0</span></div>
        </div>
        <canvas id="gameCanvas" width="400" height="600">
            –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç HTML5 Canvas
        </canvas>
        <div class="controls-info">
            üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –ö–Ω–æ–ø–∫–∏ –Ω–∏–∂–µ | üéØ –°—Ç—Ä–µ–ª—è–π —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –≤–∏–¥–µ–Ω!
        </div>
        <div class="instructions">
            –°–ø—Ä—è—á—å—Å—è –∑–∞ —É–∫—Ä—ã—Ç–∏–µ–º ‚Üí –í—ã—Å–æ–≤—ã–≤–∞–π—Å—è ‚Üí –°—Ç—Ä–µ–ª—è–π ‚Üí –ü—Ä—è—á—å—Å—è!
        </div>
    </div>

    <script>
        // === –ù–ê–°–¢–†–û–ô–ö–ò –ò–ì–†–´ ===
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const healthDisplay = document.getElementById('health');
        const scoreDisplay = document.getElementById('score');
        
        // –ê–≤—Ç–æ–ø–æ–¥—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–¥ —Ç–µ–ª–µ—Ñ–æ–Ω
        function resizeCanvas() {
            const maxWidth = Math.min(400, window.innerWidth - 40);
            const aspectRatio = 400 / 600;
            canvas.width = maxWidth;
            canvas.height = maxWidth / aspectRatio;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –∫–Ω–æ–ø–æ–∫
            updateButtonPositions();
        }
        
        // –ò–≥—Ä–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã
        let player = { 
            x: 0, y: 0, w: 30, h: 40, 
            health: 100, visible: false 
        };
        
        let cover = { 
            x: 0, y: 0, w: 60, h: 70 
        };
        
        let enemy = { 
            x: 0, y: 0, w: 30, h: 40, 
            shotReady: true, moveTimer: 0 
        };
        
        let bullets = [];
        let enemyBullets = [];
        let score = 0;
        let gameOver = false;
        
        // –°–µ–Ω—Å–æ—Ä–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ (–ø–æ–∑–∏—Ü–∏–∏ –æ–±–Ω–æ–≤—è—Ç—Å—è –ø–æ—Å–ª–µ —Ä–µ—Å–∞–π–∑–∞)
        let btnLeft = { x: 0, y: 0, w: 0, h: 0, pressed: false };
        let btnRight = { x: 0, y: 0, w: 0, h: 0, pressed: false };
        let btnShoot = { x: 0, y: 0, w: 0, h: 0, pressed: false };
        
        function updateButtonPositions() {
            const btnSize = canvas.width * 0.15;
            const margin = canvas.width * 0.05;
            
            btnLeft.w = btnLeft.h = btnRight.w = btnRight.h = btnShoot.w = btnShoot.h = btnSize;
            btnLeft.x = margin;
            btnLeft.y = canvas.height - btnSize - margin;
            btnRight.x = btnLeft.x + btnSize + margin;
            btnRight.y = btnLeft.y;
            btnShoot.x = canvas.width - btnSize - margin;
            btnShoot.y = btnLeft.y;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏–∏ –∏–≥—Ä–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
            player.w = canvas.width * 0.075;
            player.h = canvas.width * 0.1;
            player.x = canvas.width * 0.15;
            player.y = canvas.height * 0.5;
            
            cover.w = canvas.width * 0.15;
            cover.h = canvas.width * 0.175;
            cover.x = canvas.width * 0.1;
            cover.y = canvas.height * 0.47;
            
            enemy.w = canvas.width * 0.075;
            enemy.h = canvas.width * 0.1;
            enemy.x = canvas.width * 0.7;
            enemy.y = canvas.height * 0.5;
        }
        
        // === –°–ï–ù–°–û–†–ù–û–ï –£–ü–†–ê–í–õ–ï–ù–ò–ï ===
        function setupTouchControls() {
            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', handleTouchEnd);
            
            // –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –ü–ö
            canvas.addEventListener('mousedown', handleMouse);
            canvas.addEventListener('mousemove', handleMouse);
            canvas.addEventListener('mouseup', handleTouchEnd);
        }
        
        function handleTouch(e) {
            e.preventDefault();
            const touches = e.type === 'mousedown' || e.type === 'mousemove' 
                ? [{ clientX: e.clientX, clientY: e.clientY }] 
                : e.touches;
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏
            btnLeft.pressed = btnRight.pressed = btnShoot.pressed = false;
            
            for (let i = 0; i < touches.length; i++) {
                const touch = touches[i];
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                const x = (touch.clientX - rect.left) * scaleX;
                const y = (touch.clientY - rect.top) * scaleY;
                
                checkButtonPress(x, y, true);
            }
        }
        
        function handleMouse(e) {
            handleTouch(e);
        }
        
        function handleTouchEnd(e) {
            e.preventDefault();
            btnLeft.pressed = btnRight.pressed = btnShoot.pressed = false;
        }
        
        function checkButtonPress(x, y, pressed) {
            const checkButton = (btn) => {
                return x > btn.x && x < btn.x + btn.w &&
                       y > btn.y && y < btn.y + btn.h;
            };
            
            if (checkButton(btnLeft)) btnLeft.pressed = pressed;
            if (checkButton(btnRight)) btnRight.pressed = pressed;
            if (checkButton(btnShoot)) btnShoot.pressed = pressed;
        }
        
        // === –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê ===
        function updateGame() {
            if (gameOver) return;
            
            // –î–≤–∏–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
            const moveSpeed = canvas.width * 0.01;
            if (btnLeft.pressed && player.x > 0) player.x -= moveSpeed;
            if (btnRight.pressed && player.x < canvas.width - player.w) player.x += moveSpeed;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–∫—Ä—ã—Ç–∏—è
            player.visible = !(player.x > cover.x && 
                             player.x + player.w < cover.x + cover.w &&
                             player.y > cover.y);
            
            // –°—Ç—Ä–µ–ª—å–±–∞ –∏–≥—Ä–æ–∫–∞
            if (btnShoot.pressed && player.visible && bullets.length < 5) {
                bullets.push({ 
                    x: player.x + player.w/2, 
                    y: player.y + player.h/2, 
                    speed: canvas.width * 0.02,
                    radius: canvas.width * 0.012
                });
                btnShoot.pressed = false;
            }
            
            // –î–≤–∏–∂–µ–Ω–∏–µ –≤—Ä–∞–≥–∞
            enemy.moveTimer++;
            if (enemy.moveTimer > 120) {
                enemy.x = canvas.width * 0.6 + Math.random() * canvas.width * 0.3;
                enemy.moveTimer = 0;
            }
            
            // –°—Ç—Ä–µ–ª—å–±–∞ –≤—Ä–∞–≥–∞
            if (player.visible && enemy.shotReady) {
                enemyBullets.push({ 
                    x: enemy.x, 
                    y: enemy.y + enemy.h/2, 
                    speed: canvas.width * 0.015,
                    radius: canvas.width * 0.01
                });
                enemy.shotReady = false;
                setTimeout(() => enemy.shotReady = true, 1500);
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—É–ª—å –∏–≥—Ä–æ–∫–∞
            for (let i = bullets.length - 1; i >= 0; i--) {
                bullets[i].x += bullets[i].speed;
                
                // –ü–æ–ø–∞–¥–∞–Ω–∏–µ –≤–æ –≤—Ä–∞–≥–∞
                if (bullets[i].x > enemy.x && bullets[i].x < enemy.x + enemy.w &&
                    bullets[i].y > enemy.y && bullets[i].y < enemy.y + enemy.h) {
                    bullets.splice(i, 1);
                    score += 10;
                    scoreDisplay.textContent = score;
                    enemy.x = canvas.width * 0.6 + Math.random() * canvas.width * 0.3;
                }
                else if (bullets[i].x > canvas.width) {
                    bullets.splice(i, 1);
                }
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—É–ª—å –≤—Ä–∞–≥–∞
            for (let i = enemyBullets.length - 1; i >= 0; i--) {
                enemyBullets[i].x -= enemyBullets[i].speed;
                
                // –ü–æ–ø–∞–¥–∞–Ω–∏–µ –≤ –∏–≥—Ä–æ–∫–∞
                if (enemyBullets[i].x > player.x && enemyBullets[i].x < player.x + player.w &&
                    enemyBullets[i].y > player.y && enemyBullets[i].y < player.y + player.h &&
                    player.visible) {
                    enemyBullets.splice(i, 1);
                    player.health -= 5;
                    healthDisplay.textContent = player.health + '%';
                    
                    if (player.health <= 0) {
                        player.health = 0;
                        gameOver = true;
                        setTimeout(showGameOverScreen, 100);
                    }
                }
                else if (enemyBullets[i].x < 0) {
                    enemyBullets.splice(i, 1);
                }
            }
        }
        
        // === –û–¢–†–ò–°–û–í–ö–ê ===
        function draw() {
            // –§–æ–Ω
            ctx.fillStyle = '#87CEEB';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –û–±–ª–∞–∫–∞ –Ω–∞ —Ñ–æ–Ω–µ
            ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
            for (let i = 0; i < 3; i++) {
                const cloudX = (Date.now() * 0.01 + i * 100) % (canvas.width + 200) - 100;
                const cloudY = 50 + i * 40;
                drawCloud(cloudX, cloudY, canvas.width * 0.1);
            }
            
            // –ó–µ–º–ª—è
            ctx.fillStyle = '#8BC34A';
            ctx.fillRect(0, canvas.height * 0.6, canvas.width, canvas.height * 0.4);
            
            // –£–∫—Ä—ã—Ç–∏–µ
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(cover.x, cover.y, cover.w, cover.h);
            
            // –¢–µ–∫—Å—Ç—É—Ä–∞ —É–∫—Ä—ã—Ç–∏—è
            ctx.fillStyle = '#A0522D';
            for (let i = 0; i < 3; i++) {
                ctx.fillRect(cover.x + 5, cover.y + 5 + i * 20, cover.w - 10, 10);
            }
            
            // –ò–≥—Ä–æ–∫
            ctx.fillStyle = player.visible ? '#FF4444' : '#44FF44';
            ctx.fillRect(player.x, player.y, player.w, player.h);
            
            // –ì–ª–∞–∑ –∏–≥—Ä–æ–∫–∞
            ctx.fillStyle = '#000';
            ctx.fillRect(player.x + player.w - 8, player.y + 10, 5, 5);
            
            // –í—Ä–∞–≥
            ctx.fillStyle = '#8844FF';
            ctx.fillRect(enemy.x, enemy.y, enemy.w, enemy.h);
            
            // –ì–ª–∞–∑ –≤—Ä–∞–≥–∞
            ctx.fillStyle = '#000';
            ctx.fillRect(enemy.x + 5, enemy.y + 10, 5, 5);
            
            // –ü—É–ª–∏ –∏–≥—Ä–æ–∫–∞
            ctx.fillStyle = '#FFFF00';
            for (let b of bullets) {
                ctx.beginPath();
                ctx.arc(b.x, b.y, b.radius, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // –ü—É–ª–∏ –≤—Ä–∞–≥–∞
            ctx.fillStyle = '#FF8800';
            for (let b of enemyBullets) {
                ctx.beginPath();
                ctx.arc(b.x, b.y, b.radius, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // –°–µ–Ω—Å–æ—Ä–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
            drawButton(btnLeft, "‚Üê", "#4CAF50");
            drawButton(btnRight, "‚Üí", "#2196F3");
            drawButton(btnShoot, "‚ö°", btnShoot.pressed ? "#FF5722" : "#FFC107");
            
            // –°—Ç–∞—Ç—É—Å –≤–∏–¥–∏–º–æ—Å—Ç–∏
            ctx.fillStyle = player.visible ? '#FF4444' : '#44FF44';
            ctx.font = `bold ${canvas.width * 0.04}px Arial`;
            const statusText = player.visible ? '–í–ò–î–ï–ù –í–†–ê–ì–£!' : '–í –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò';
            const textWidth = ctx.measureText(statusText).width;
            ctx.fillText(statusText, (canvas.width - textWidth) / 2, canvas.height * 0.15);
        }
        
        function drawButton(btn, text, color) {
            // –¢–µ–Ω—å
            ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
            ctx.fillRect(btn.x + 3, btn.y + 3, btn.w, btn.h);
            
            // –ö–Ω–æ–ø–∫–∞
            ctx.fillStyle = btn.pressed ? '#333' : color;
            ctx.beginPath();
            ctx.roundRect(btn.x, btn.y, btn.w, btn.h, 15);
            ctx.fill();
            
            // –¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
            ctx.fillStyle = 'white';
            ctx.font = `bold ${btn.w * 0.5}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(text, btn.x + btn.w/2, btn.y + btn.h/2);
        }
        
        function drawCloud(x, y, size) {
            ctx.beginPath();
            ctx.arc(x, y, size, 0, Math.PI * 2);
            ctx.arc(x + size * 0.8, y - size * 0.3, size * 0.7, 0, Math.PI * 2);
            ctx.arc(x + size * 1.5, y, size, 0, Math.PI * 2);
            ctx.fill();
        }
        
        function showGameOverScreen() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = '#FF4444';
            ctx.font = `bold ${canvas.width * 0.08}px Arial`;
            ctx.textAlign = 'center';
            ctx.fillText('–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê', canvas.width/2, canvas.height/2 - 40);
            
            ctx.fillStyle = '#FFFF00';
            ctx.font = `bold ${canvas.width * 0.06}px Arial`;
            ctx.fillText(`–û—á–∫–∏: ${score}`, canvas.width/2, canvas.height/2 + 10);
            
            ctx.fillStyle = '#FFFFFF';
            ctx.font = `${canvas.width * 0.04}px Arial`;
            ctx.fillText('–ö–æ—Å–Ω–∏—Ç–µ—Å—å –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞', canvas.width/2, canvas.height/2 + 60);
            
            canvas.addEventListener('touchstart', restartGame, { once: true });
            canvas.addEventListener('mousedown', restartGame, { once: true });
        }
        
        function restartGame() {
            player.health = 100;
            healthDisplay.textContent = '100%';
            score = 0;
            scoreDisplay.textContent = '0';
            bullets = [];
            enemyBullets = [];
            enemy.shotReady = true;
            enemy.moveTimer = 0;
            gameOver = false;
            
            // –°–±—Ä–æ—Å –ø–æ–∑–∏—Ü–∏–π
            updateButtonPositions();
            player.x = canvas.width * 0.15;
            enemy.x = canvas.width * 0.7;
        }
        
        // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function gameLoop() {
            updateGame();
            draw();
            requestAnimationFrame(gameLoop);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.addEventListener('load', () => {
            resizeCanvas();
            setupTouchControls();
            gameLoop();
        });
        
        window.addEventListener('resize', resizeCanvas);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–æ–¥ roundRect –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
        if (!CanvasRenderingContext2D.prototype.roundRect) {
            CanvasRenderingContext2D.prototype.roundRect = function(x, y, w, h, r) {
                if (w < 2 * r) r = w / 2;
                if (h < 2 * r) r = h / 2;
                this.beginPath();
                this.moveTo(x + r, y);
                this.arcTo(x + w, y, x + w, y + h, r);
                this.arcTo(x + w, y + h, x, y + h, r);
                this.arcTo(x, y + h, x, y, r);
                this.arcTo(x, y, x + w, y, r);
                this.closePath();
                return this;
            }
        }
    </script>
</body>
</html>
